////
StarForth Dictionary Security Analysis

Document Metadata:
- Document ID: starforth-governance/dictionary-security-analysis
- Version: 1.0.0
- Purpose: Analyze dictionary structure for security and capability integration
- Status: READY FOR VALIDATION
////

= StarForth Dictionary Security Analysis

**Document ID:** starforth-governance/dictionary-security-analysis
**Version:** 1.0.0
**Date:** 2025-10-25

---

== Dictionary Structure

```c
struct DictEntry {
    struct DictEntry *link;      // Linked list chain (backward pointer)
    const char *name;             // Word name (C string)
    size_t name_len;              // Name length (for performance)
    uint16_t flags;               // IMMEDIATE, COMPILE-ONLY, etc.
    void (*func)(struct VM *);    // Execution function pointer
    void *body;                   // Optional body data (CREATE/DOES>)
    size_t body_size;             // Body size in bytes
    struct ACLCache acl_cache;    // ACL cache entry (Tier II addition)
}
```

---

== Security Properties

### Word Immutability

**Guarantee:** Once defined, a word's properties cannot be changed (except IMMEDIATE flag)

**Implementation:**
- DictEntry structure immutable after creation
- No field mutation after linking
- SMUDGE/UNSMUDGE only affects visibility

**Security Implication:** Word behavior cannot be altered post-definition

---

### FORGET Fence

**Guarantee:** System words (dictionary fence) cannot be removed

**Implementation:**
```c
if (word_to_forget >= dictionary_fence) {
    error("Cannot forget system word");
    return;
}
```

**Security Implication:** Core VM cannot be disabled or damaged

**System Words Protected:**
- All 70 FORTH-79 core words
- Fence location: configurable, set after boot

---

### Word Visibility Control

**SMUDGE/UNSMUDGE:** Words can be hidden but not deleted

**Current Flag Bits:**
- Bit 0: IMMEDIATE
- Bit 1: HIDDEN
- Bit 2: (reserved)
- Bits 3-15: (available for future use)

**Security Implication:** Can hide words without deletion risk

---

### Linked List Ordering

**Property:** Dictionary is singly-linked list (no back-pointers)

**Lookup Order:** Newest-to-oldest (most recent definition shadows older)

**Security Implication:**
- ✓ Standard Forth semantics preserved
- ✓ Word shadowing possible (no issue)
- ✓ No delete-undelete cycles

---

## Capability Integration Points

### Word Definition (Create Phase)

**Current Process:**
```
1. User types ": NAME word1 word2 ;"
2. Parser enters compilation mode
3. Words word1, word2 are compiled (references stored)
4. Upon ;, DictEntry created and linked
```

**With Capability Integration:**
- Check DEFINE capability at `:` (start definition)
- Check capabilities for each word referenced
- Store required capability in word's ACL cache
- At `; ` link to dictionary (requires ALLOCATE capability)

### Word Deletion (FORGET)

**Current Process:**
```
1. User types "FORGET WORDNAME"
2. Find word in dictionary
3. Check fence (don't forget system words)
4. Unlink from chain (update link pointers)
5. Free memory (return to allocator)
```

**With Capability Integration:**
- Check ALLOCATE capability (or SYSTEM capability)
- Prevent deletion of words owned by other VM contexts
- Audit log deletion events

### Word Execution (Call Phase)

**Current Process:**
```
1. Parser finds word in dictionary
2. Get DictEntry (contains func pointer)
3. Call func(vm) directly
```

**With Capability Integration:**
- Check EXECUTE capability
- Check word-specific required capabilities
- Use cached ACL result
- Deny execution if capability lacking

---

## Current Vulnerabilities & Mitigations

### Vulnerability 1: Direct Dictionary Manipulation

**Risk:** If someone could directly modify DictEntry, they could:
- Change func pointer to arbitrary code
- Modify flags
- Alter word behavior

**Current Mitigation:**
- No public API to modify DictEntry
- Dictionary stored in private VM memory
- Only word definition mechanism can create entries

**Future Mitigation (Tier III):**
- Read-only memory regions
- Capability-based access control
- Audit logging of all modifications

---

### Vulnerability 2: FORGET Abuse

**Risk:** Attacker could FORGET system words if no fence

**Current Mitigation:**
- ✓ FORGET fence implemented
- System words protected
- Fence location configurable

**Security Level:** STRONG

---

## ACL-Ready Features

### Ready Now (No Changes Needed)

- [ ] Linked-list structure supports ownership tagging
- [ ] Function pointer immutability supports trusted execution
- [ ] FORGET fence provides access control precedent
- [ ] Flags field supports ACL annotation

### Requires Phase III Implementation

- [ ] Capability field in DictEntry
- [ ] Owner UID tracking
- [ ] ACL caching mechanism
- [ ] Audit logging
- [ ] Read-only memory enforcement

---

== Approval

**Dictionary security analysis complete:** ✓ YES

**No architectural barriers to ACL integration:** ✓ YES

**Analysis Summary:**
- Dictionary structure: Suitable for ACL integration ✓
- Word immutability: Enforced, no post-definition changes ✓
- FORGET fence: System words protected ✓
- Visibility control: SMUDGE/UNSMUDGE available ✓
- Security properties: STRONG ✓
- Capability readiness: HIGH ✓

---

## Document Approval & Signature

[cols="2,2,1"]
|===
| Role | Name/Title | Signature

| **Author/Maintainer**
| Robert A. James
|

| **Date Approved**
| 25 October, 2025
| _______________

| **PGP Fingerprint**
| 497CF5C0D295A7E8065C5D9A9CD3FBE66B5E2AE4
|

|===

**Archive Location:** ~/StarForth-Governance/Validation/TIER_II_QUALITY/