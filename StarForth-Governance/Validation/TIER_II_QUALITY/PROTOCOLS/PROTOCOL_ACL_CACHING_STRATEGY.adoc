////
StarForth Tier II ACL Caching Strategy Validation Protocol

Document Metadata:
- Document ID: starforth-governance/protocol-acl-caching-strategy
- Version: 1.0.0
- Created: 2025-10-25
- Purpose: Validate ACL caching strategy for performance and security
- Scope: Compile-time ACL resolution, cache validation, performance
- Status: GOVERNANCE FRAMEWORK
////

= StarForth Tier II: ACL Caching Strategy Validation Protocol

**Document ID:** starforth-governance/protocol-acl-caching-strategy
**Version:** 1.0.0
**Date:** 2025-10-25
**Status:** Ready for Execution

---

== Protocol Overview

This protocol validates the ACL caching strategy that enables efficient capability checking without runtime overhead.

**Success Criteria:**
- ACL_CACHING_STRATEGY.adoc complete with algorithm
- Compile-time ACL resolution algorithm documented
- Cache structure and invalidation designed
- Cache validation tests passing
- Performance baseline: cache hits > cache misses by >10x
- Revocation window (TTL) enforced
- No cache bypass vulnerabilities

---

== Phase 1: Caching Strategy Design

=== 1.1 Compile-Time ACL Resolution

Document in ACL_CACHING_STRATEGY.adoc:

**Design Principle:**
- ACL computations performed at dictionary build time
- Results cached in DictEntry
- Hot path (word execution) uses cached value
- Zero runtime ACL computation overhead

**Algorithm:**
```
At compile time (when word is defined):
  1. Determine word's required capabilities
  2. Compute ACL result for current VM context
  3. Store result in DictEntry cache
  4. Set cache expiration (TTL)

At execution time (word EXECUTE):
  1. Check cache validity (not expired)
  2. If valid: use cached capability result (O(1))
  3. If expired: recompute and update cache
  4. Execute word or deny with ACL error
```

=== 1.2 Cache Data Structure

Design cache entry:
```c
struct ACLCache {
    uint32_t capability_mask;    // Cached ACL result
    uint64_t expiration_time;    // Cache TTL expiration
    uint8_t valid;               // Cache validity flag
    uint8_t recompute_needed;    // Force recomputation flag
}
```

=== 1.3 Invalidation Strategy

Define when cache is invalidated:
- [ ] TTL expiration (time-based)
- [ ] Capability revocation (event-based)
- [ ] Dictionary modification (if word depends on definitions)
- [ ] VM context change

---

== Phase 2: Test Suite Development

=== 2.1 Compile-Time ACL Test (T2-6A)

**Unit Tests:**
- [ ] ACL calculation correct for read capability
- [ ] ACL calculation correct for write capability
- [ ] ACL calculation correct for execute capability
- [ ] Multiple capability combinations work
- [ ] Inherited capabilities computed correctly
- [ ] Denied operations return ACL_DENIED

**Test Commands:**
```bash
# Build with ACL caching enabled
make clean && make ENABLE_ACL=1 test

# Run ACL unit tests
./build/starforth --run-acl-tests
```

=== 2.2 Cache Lookup Behavior Test (T2-6B)

**Integration Tests:**
- [ ] Cache hit returns same result as recomputation
- [ ] Cache miss triggers recomputation
- [ ] Cached value used on second access
- [ ] Cache populated on first word execution
- [ ] Multiple words build separate cache entries
- [ ] Cache memory usage reasonable

**Verification:**
```bash
# Run with cache statistics enabled
./build/starforth --run-tests --acl-cache-stats

# Expected output:
# Cache hits: X
# Cache misses: Y
# Ratio (hits/total): >90%
```

=== 2.3 Revocation Enforcement Test (T2-6C)

**Capability Change Tests:**
- [ ] Revoking capability immediately affects word access
- [ ] Revocation takes effect within TTL window
- [ ] Word execution denied after revocation
- [ ] Re-granting capability allows access again
- [ ] Revocation of one capability doesn't affect others

**Test Scenario:**
```
1. Grant READ capability to VM
2. Execute READ word (succeeds)
3. Revoke READ capability
4. Execute READ word (denied)
5. Grant READ capability again
6. Execute READ word (succeeds)
```

=== 2.4 Performance Baseline Test (T2-6D)

**Benchmark Tests:**
- [ ] Cache hit performance: <100 nanoseconds
- [ ] Cache miss performance: <1 microsecond
- [ ] Memory overhead: <1 MB for 100 VMs × 1000 words
- [ ] Cache hit ratio: >90% for typical workloads

**Measurements:**
```bash
# Run performance benchmarks
./build/starforth --benchmark-acl-cache

# Expected output:
# Cache hit time: XXX ns
# Cache miss time: XXX ns
# Hit ratio: 92%
# Memory overhead: 856 KB
```

---

== Phase 3: Cache Validation

=== 3.1 Correctness Verification

- [ ] Cache results match recomputation results
- [ ] No stale cache entries returned
- [ ] TTL expiration works correctly
- [ ] Invalidation signals trigger recomputation
- [ ] All test paths exercised

=== 3.2 Security Verification

Check for vulnerabilities:
- [ ] No cache bypass via direct memory access
- [ ] Capability cannot be elevated via cache manipulation
- [ ] Revocation cannot be bypassed via stale cache
- [ ] TTL cannot be artificially extended
- [ ] Cache corruption detected/prevented

---

== Phase 4: Performance Analysis

=== 4.1 Baseline Measurements

Document:
- **Cache hit time:** (measured)
- **Cache miss time:** (measured)
- **Cache hit ratio:** (% of word executions)
- **Memory overhead:** (total cache size in bytes)
- **Worst-case path:** (maximum permission check time)

=== 4.2 Optimization Opportunities

If performance below target:
- Increase TTL for longer cache validity
- Implement more granular cache invalidation
- Add fast-path for common capabilities
- Consider compile-time constant folding

---

== Phase 5: Documentation

Generate ACL_CACHING_STRATEGY.adoc containing:

1. **Caching Strategy Overview**
   - Design rationale
   - Performance goals
   - Security guarantees

2. **Compile-Time ACL Resolution Algorithm**
   - Pseudocode
   - Complexity analysis
   - Edge cases handled

3. **Cache Data Structure**
   - Memory layout
   - Field descriptions
   - Size on different architectures

4. **Invalidation Mechanism**
   - When cache is invalidated
   - How invalidation is triggered
   - TTL handling

5. **Test Results**
   - Unit tests: all pass
   - Integration tests: all pass
   - Performance benchmarks: all meet targets
   - Security validation: no bypasses found

6. **Performance Baseline**
   - Measured cache hit/miss times
   - Hit ratio statistics
   - Memory overhead analysis

7. **Approval Signatures**

---

== Success Criteria

✓ PASS when all of the following are true:
- [ ] ACL_CACHING_STRATEGY.adoc complete and reviewed
- [ ] Algorithm documented with pseudocode
- [ ] Cache structure designed and documented
- [ ] Invalidation strategy defined
- [ ] All T2-6A unit tests pass
- [ ] All T2-6B integration tests pass
- [ ] All T2-6C revocation tests pass
- [ ] All T2-6D performance benchmarks meet targets
- [ ] Cache overhead <1MB for baseline scenario
- [ ] No ACL bypasses via cache manipulation found
- [ ] TTL enforcement verified
- [ ] Specification signed and dated

✗ FAIL if:
- [ ] Cache correctness test fails
- [ ] Revocation can be bypassed
- [ ] Performance below 10x hit ratio
- [ ] Memory overhead exceeds 1MB
- [ ] Cache bypass vulnerability found
- [ ] TTL enforcement fails

---

== Document History

[cols="^1,^2,2,<4"]
|===
| Version | Date | Author | Change Summary

| 1.0.0
| 2025-10-25
| Validation Engineer
| Created ACL caching strategy validation protocol
|===

---

== Document Approval & Signature

[cols="2,2,1"]
|===
| Role | Name/Title | Signature

| **Author/Maintainer**
| Robert A. James
|

| **Date Approved**
| 25 October, 2025
| _______________

| **PGP Fingerprint**
| 497CF5C0D295A7E8065C5D9A9CD3FBE66B5E2AE4
|

|===

**Archive Location:** ~/StarForth-Governance/Validation/TIER_II_QUALITY/PROTOCOLS/