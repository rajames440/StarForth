////
StarForth Tier II Code Quality Validation Protocol

Document Metadata:
- Document ID: starforth-governance/protocol-code-quality
- Version: 1.0.0
- Created: 2025-10-25
- Purpose: Establish code quality baseline using static analysis
- Scope: SonarQube/Clang analyzer validation
- Status: GOVERNANCE FRAMEWORK
////

= StarForth Tier II: Code Quality Validation Protocol

**Document ID:** starforth-governance/protocol-code-quality
**Version:** 1.0.0
**Date:** 2025-10-25
**Status:** Ready for Execution

---

== Protocol Overview

This protocol establishes a code quality baseline for StarForth using industry-standard static analysis tools and metrics.

**Success Criteria:**
- SonarQube baseline established with documented metrics
- Critical issues = 0
- High severity issues < 5
- Code duplication < 5%
- Cyclomatic complexity average < 10
- Metrics report signed and dated

---

== Phase 1: Setup

=== 1.1 Install Static Analysis Tools

**Tools Required:**
- SonarQube Community Edition (or SonarCloud)
- Clang Static Analyzer
- cppcheck (optional but recommended)

**Installation Steps:**
```bash
# SonarQube setup (if self-hosted)
docker run -d --name sonarqube -p 9000:9000 sonarqube:community

# Clang Static Analyzer (usually available with clang)
which scan-build

# cppcheck
sudo apt-get install cppcheck
```

=== 1.2 Configure SonarQube

Create `sonar-project.properties` in StarForth root:
```ini
sonar.projectKey=starforth
sonar.projectName=StarForth
sonar.projectVersion=1.0
sonar.sources=src
sonar.exclusions=**/*test*,**/vendor/**
sonar.c.file.suffixes=.c,.h
sonar.coverage.exclusions=**/*test*
```

---

== Phase 2: Baseline Analysis

=== 2.1 Run SonarQube Analysis

```bash
cd ~/CLionProjects/StarForth

# Build scanner (if using SonarQube Community)
sonar-scanner -Dsonar.host.url=http://localhost:9000 \
              -Dsonar.login=[TOKEN]

# Alternative: Use SonarCloud for online analysis
```

=== 2.2 Run Clang Static Analyzer

```bash
# Clean build with scan-build
scan-build -o /tmp/clang-analysis make clean
scan-build -o /tmp/clang-analysis make

# Generate HTML report
scan-build -o /tmp/clang-analysis -v make
```

=== 2.3 Run cppcheck

```bash
cppcheck --enable=all --xml --xml-version=2 \
         --suppress=missingIncludeSystem \
         src/ 2>/tmp/cppcheck-report.xml

cppcheck --enable=all --output-file=/tmp/cppcheck-report.txt src/
```

---

== Phase 3: Metric Collection

=== 3.1 SonarQube Metrics to Record

| Metric | Threshold | Target |
|--------|-----------|--------|
| Critical Issues | 0 | 0 |
| High Severity Issues | < 5 | < 3 |
| Medium Issues | (documented) | (trending down) |
| Code Duplication | < 5% | < 3% |
| Cyclomatic Complexity (avg) | < 10 | < 8 |
| Cognitive Complexity (avg) | < 15 | < 10 |
| Test Coverage | ≥ 80% | ≥ 90% (from Tier I) |
| Maintainability Index | ≥ 85 | ≥ 90 |

=== 3.2 Clang Analyzer Results

Document all findings:
- Null pointer dereference
- Use-after-free
- Buffer overflows
- Logic errors
- Resource leaks

=== 3.3 cppcheck Results

Document all warnings and errors by category

---

== Phase 4: Resolution

=== 4.1 Critical Issues (MUST RESOLVE)

All critical issues must be:
1. Fixed in code, OR
2. Documented as false positive with evidence, OR
3. Documented as known limitation with risk acceptance

=== 4.2 High Severity Issues

High severity issues must be reduced to < 5:
- Target: < 3
- Document each one with resolution plan
- Track resolution status

=== 4.3 Code Duplication

If code duplication > 5%:
- Identify duplicate blocks
- Refactor or document rationale
- Target < 3%

---

== Phase 5: Documentation

Generate CODE_QUALITY_BASELINE_REPORT.adoc containing:
- Date of analysis
- Tool versions
- Metrics summary table
- Critical issues (with resolutions)
- High severity issues (with resolutions)
- Duplication analysis
- Complexity analysis
- Maintainability rating
- SonarQube dashboard link (if applicable)
- HTML reports archived

---

== Success Criteria

✓ PASS when all of the following are true:
- [ ] SonarQube baseline established
- [ ] Critical issues = 0
- [ ] High issues < 5
- [ ] Code duplication < 5%
- [ ] Cyclomatic complexity avg < 10
- [ ] Metrics report complete and reviewed
- [ ] All findings resolved or documented
- [ ] Report dated and signed

✗ FAIL if:
- [ ] Critical issues > 0
- [ ] High issues ≥ 5
- [ ] Analysis cannot be completed
- [ ] Significant new issues introduced

---

== Document History

[cols="^1,^2,2,<4"]
|===
| Version | Date | Author | Change Summary

| 1.0.0
| 2025-10-25
| Validation Engineer
| Created code quality validation protocol
|===

---

== Document Approval & Signature

[cols="2,2,1"]
|===
| Role | Name/Title | Signature

| **Author/Maintainer**
| Robert A. James
|

| **Date Approved**
| 25 October, 2025
| _______________

| **PGP Fingerprint**
| 497CF5C0D295A7E8065C5D9A9CD3FBE66B5E2AE4
|

|===

**Archive Location:** ~/StarForth-Governance/Validation/TIER_II_QUALITY/PROTOCOLS/