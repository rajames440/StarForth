////
StarForth Requirements Specification

Document Metadata:
- Document ID: starforth-governance/requirements-specification
- Version: 1.0.0
- Created: 2025-10-25
- Purpose: Define all functional and quality requirements for StarForth
- Scope: 70 FORTH-79 core words plus quality requirements
- Status: APPROVED
////

= StarForth Requirements Specification

**Version:** 1.0.0
**Status:** Approved
**Last Updated:** 2025-10-25

---

== Executive Summary

This document defines all requirements for StarForth v1.0 as a FORTH-79 compliant virtual machine. Requirements are organized into three categories:

1. **Functional Requirements** - The 70 FORTH-79 core words
2. **Quality Requirements** - Non-functional properties
3. **Architectural Requirements** - Design constraints

Total requirements: **73 (70 functional + 3 quality)**

---

== What is StarForth?

StarForth is a **FORTH-79 Virtual Machine** implemented in ANSI C99.

- **Purpose:** Execute Forth programs with FORTH-79 standard semantics
- **Platform:** Linux x86_64, ARM64, and other platforms via abstraction layer
- **Memory Model:** Fixed 5MB arena with segmented allocation
- **Execution Model:** Direct-threaded interpreter with two stacks
- **Compliance:** 100% FORTH-79 core word compatibility

---

== Section 1: Functional Requirements (FORTH-79 Core Words)

=== 1.1 Stack Operations (6 words)

[cols="1,2,2"]
|===
| REQ-ID | Word | Specification

| REQ-FORTH-79-STACK-001 | DUP | Duplicate top of stack. (x -- x x)
| REQ-FORTH-79-STACK-002 | DROP | Remove top of stack. (x -- )
| REQ-FORTH-79-STACK-003 | SWAP | Exchange top two stack items. (x y -- y x)
| REQ-FORTH-79-STACK-004 | OVER | Copy second item to top. (x y -- x y x)
| REQ-FORTH-79-STACK-005 | ROT | Rotate top three. (x y z -- y z x)
| REQ-FORTH-79-STACK-006 | DEPTH | Get stack depth. (-- n)

|===

[#_1_2_arithmetic_operations_12_words]
=== 1.2 Arithmetic Operations (12 words)

[cols="1,2,2"]
|===
| REQ-ID | Word | Specification

| REQ-FORTH-79-ARITH-001 | + | Addition. (n1 n2 -- n)
| REQ-FORTH-79-ARITH-002 | - | Subtraction. (n1 n2 -- n)
| REQ-FORTH-79-ARITH-003 | * | Multiplication. (n1 n2 -- n)
| REQ-FORTH-79-ARITH-004 | / | Division (truncated). (n1 n2 -- n)
| REQ-FORTH-79-ARITH-005 | MOD | Modulo. (n1 n2 -- n)
| REQ-FORTH-79-ARITH-006 | /MOD | Divide and modulo. (n1 n2 -- n3 n4)
| REQ-FORTH-79-ARITH-007 | ABS | Absolute value. (n -- |n|)
| REQ-FORTH-79-ARITH-008 | NEGATE | Negation. (n -- -n)
| REQ-FORTH-79-ARITH-009 | MIN | Minimum. (n1 n2 -- n)
| REQ-FORTH-79-ARITH-010 | MAX | Maximum. (n1 n2 -- n)
| REQ-FORTH-79-ARITH-011 | 1+ | Increment. (n -- n+1)
| REQ-FORTH-79-ARITH-012 | 1- | Decrement. (n -- n-1)

|===

=== 1.3 Memory Access (8 words)

[cols="1,2,2"]
|===
| REQ-ID | Word | Specification

| REQ-FORTH-79-MEM-001 | @ | Fetch cell from address. (addr -- n)
| REQ-FORTH-79-MEM-002 | ! | Store cell to address. (n addr -- )
| REQ-FORTH-79-MEM-003 | C@ | Fetch byte from address. (addr -- c)
| REQ-FORTH-79-MEM-004 | C! | Store byte to address. (c addr -- )
| REQ-FORTH-79-MEM-005 | +! | Add and store. (n addr -- )
| REQ-FORTH-79-MEM-006 | ALLOT | Allocate dictionary space. (n -- )
| REQ-FORTH-79-MEM-007 | HERE | Get dictionary pointer. (-- addr)
| REQ-FORTH-79-MEM-008 | CELL | Get cell size in bytes. (-- n)

|===

=== 1.4 Control Flow (12 words)

[cols="1,2,2"]
|===
| REQ-ID | Word | Specification

| REQ-FORTH-79-CTRL-001 | IF/THEN | Conditional execution. (f -- )
| REQ-FORTH-79-CTRL-002 | ELSE | Conditional branch alternative. (flag -- )
| REQ-FORTH-79-CTRL-003 | DO/LOOP | Counted loop. (n -- ) to (n -- )
| REQ-FORTH-79-CTRL-004 | +LOOP | Loop with step. (n -- )
| REQ-FORTH-79-CTRL-005 | BEGIN/UNTIL | Loop until condition. (-- )
| REQ-FORTH-79-CTRL-006 | BEGIN/WHILE/REPEAT | Conditional loop. (-- )
| REQ-FORTH-79-CTRL-007 | LEAVE | Exit loop prematurely. (-- )
| REQ-FORTH-79-CTRL-008 | EXIT | Exit definition. (-- )
| REQ-FORTH-79-CTRL-009 | I | Loop index (inner). (-- n)
| REQ-FORTH-79-CTRL-010 | J | Loop index (outer). (-- n)
| REQ-FORTH-79-CTRL-011 | ; | End definition. (-- )
| REQ-FORTH-79-CTRL-012 | EXECUTE | Execute address as code. (addr -- )

|===

=== 1.5 Input/Output (8 words)

[cols="1,2,2"]
|===
| REQ-ID | Word | Specification

| REQ-FORTH-79-IO-001 | EMIT | Output character. (c -- )
| REQ-FORTH-79-IO-002 | KEY | Input character. (-- c)
| REQ-FORTH-79-IO-003 | CR | Output carriage return. (-- )
| REQ-FORTH-79-IO-004 | SPACE | Output space. (-- )
| REQ-FORTH-79-IO-005 | TYPE | Output string. (addr len -- )
| REQ-FORTH-79-IO-006 | . | Print number. (n -- )
| REQ-FORTH-79-IO-007 | .\" | Print string in definition. (-- )
| REQ-FORTH-79-IO-008 | ." | String literal in definition. (-- )

|===

=== 1.6 Dictionary Operations (12 words)

[cols="1,2,2"]
|===
| REQ-ID | Word | Specification

| REQ-FORTH-79-DICT-001 | : | Start definition. (-- )
| REQ-FORTH-79-DICT-002 | ; | End definition. (-- )
| REQ-FORTH-79-DICT-003 | FIND | Find word in dictionary. (addr -- xt 1\|2 \|-1)
| REQ-FORTH-79-DICT-004 | EXECUTE | Execute code at address. (xt -- )
| REQ-FORTH-79-DICT-005 | CREATE | Create new word. (-- )
| REQ-FORTH-79-DICT-006 | DOES> | Define word behavior. (-- )
| REQ-FORTH-79-DICT-007 | IMMEDIATE | Mark word immediate. (-- )
| REQ-FORTH-79-DICT-008 | CONSTANT | Create constant. (n -- )
| REQ-FORTH-79-DICT-009 | VARIABLE | Create variable. (-- )
| REQ-FORTH-79-DICT-010 | FORGET | Remove definition. (-- )
| REQ-FORTH-79-DICT-011 | >BODY | Get body address. (xt -- addr)
| REQ-FORTH-79-DICT-012 | SMUDGE | Mark word hidden. (-- )

|===

=== 1.7 Logical Operations (6 words)

[cols="1,2,2"]
|===
| REQ-ID | Word | Specification

| REQ-FORTH-79-LOGIC-001 | AND | Bitwise AND. (n1 n2 -- n)
| REQ-FORTH-79-LOGIC-002 | OR | Bitwise OR. (n1 n2 -- n)
| REQ-FORTH-79-LOGIC-003 | XOR | Bitwise XOR. (n1 n2 -- n)
| REQ-FORTH-79-LOGIC-004 | NOT | Bitwise NOT. (n -- n)
| REQ-FORTH-79-LOGIC-005 | LSHIFT | Left shift. (n count -- n)
| REQ-FORTH-79-LOGIC-006 | RSHIFT | Right shift. (n count -- n)

|===

=== 1.8 Comparison Operations (6 words)

[cols="1,2,2"]
|===
| REQ-ID | Word | Specification

| REQ-FORTH-79-CMP-001 | = | Equal. (n1 n2 -- flag)
| REQ-FORTH-79-CMP-002 | <> | Not equal. (n1 n2 -- flag)
| REQ-FORTH-79-CMP-003 | < | Less than. (n1 n2 -- flag)
| REQ-FORTH-79-CMP-004 | > | Greater than. (n1 n2 -- flag)
| REQ-FORTH-79-CMP-005 | <= | Less or equal. (n1 n2 -- flag)
| REQ-FORTH-79-CMP-006 | >= | Greater or equal. (n1 n2 -- flag)

|===

---

== Section 2: Quality Requirements

[cols="1,2,3"]
|===
| REQ-ID | Requirement | Specification

| REQ-QUALITY-DETERMINISM | Deterministic Execution | All test sequences produce identical output when run multiple times with same inputs. No random behavior.

| REQ-QUALITY-MEMORY-SAFETY | Memory Safety | All memory accesses validated. Stack overflow/underflow detected. No buffer overflows. Fixed 5MB arena prevents fragmentation.

| REQ-QUALITY-PORTABILITY | Platform Portability | Identical semantics across Linux x86_64, ARM64, and other POSIX platforms. ANSI C99 compliance enables portability.

|===

---

== Section 3: Architectural Requirements

[cols="1,2,3"]
|===
| REQ-ID | Requirement | Specification

| REQ-ARCH-001 | ANSI C99 Compliance | All code must compile without errors under `gcc -std=c99 -Wall -Werror`. No compiler extensions.

| REQ-ARCH-002 | Fixed Memory Arena | All execution within fixed 5MB memory arena. No malloc or external allocation.

| REQ-ARCH-003 | Direct-Threaded Interpreter | Code execution via function pointers, not bytecode. Each word = function pointer in dictionary entry.

| REQ-ARCH-004 | Two-Stack Model | Data stack (parameter stack) and return stack, each 1024 cells. Sufficient for all FORTH-79 programs.

| REQ-ARCH-005 | Dictionary as Linked List | Words stored in linked list structure with O(n) lookup. Optimized with first-character hashing.

| REQ-ARCH-006 | Dictionary-Based Isolation | No MMU required. Isolation via dictionary boundaries and address validation.

|===

---

== Acceptance Criteria

Each requirement is ACCEPTED when:
1. **Implementation exists** - Word implemented in source code
2. **Test coverage** - Word has >=1 functional test + >=1 edge case test
3. **Documentation** - Word documented in FORTH-79_COMPLIANCE_MATRIX
4. **Traceability** - Requirement maps to test and implementation in RTM
5. **Verification** - Test passes on at least 2 platforms (x86_64, ARM64)

---

== Document History

[cols="^1,^2,2,<4"]
|===
| Version | Date | Author | Change Summary

| 1.0.0
| 2025-10-25
| Validation Engineer
| Created requirements specification with 70 core words + 3 quality requirements
|===

---

== Document Approval & Signature

[cols="2,2,1"]
|===
| Role | Name/Title | Signature

| **Author/Maintainer**
| Robert A. James
|

| **Date Approved**
| 25 oCTOBER, 2025| _______________

| **PGP Fingerprint**
| 497CF5C0D295A7E8065C5D9A9CD3FBE66B5E2AE4
|

|===

**PGP Signature Block:**
```
-----BEGIN PGP SIGNATURE-----

[Your PGP signature here - generated via: gpg --clearsign REQUIREMENTS_SPECIFICATION.adoc]

-----END PGP SIGNATURE-----
```

**To Sign This Document:**
```bash
gpg --clearsign REQUIREMENTS_SPECIFICATION.adoc
# This creates REQUIREMENTS_SPECIFICATION.adoc.asc (signed version)
```

**To Verify Signature:**
```bash
gpg --verify REQUIREMENTS_SPECIFICATION.adoc.asc
```

**Archive Location:** ~/StarForth-Governance/Validation/TIER_I_FOUNDATION/
